# [Question]: Could you assess the relationship between the poverty rates from the previous year's census data and the percentage of births without maternal morbidity for the years 2016 to 2018? Use only data for births where no maternal morbidity was reported and for each year, use the 5-year census data from the year before to compute the Pearson correlation coefficient
# [Schema links]: ["census_bureau_acs.county_2015_5yr.geo_id", "census_bureau_acs.county_2015_5yr.poverty", "census_bureau_acs.county_2015_5yr.pop_determined_poverty_status", "sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity.Year", "sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity.Births", "sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity.Maternal_Morbidity_YN", "sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity.County_of_Residence_FIPS", "census_bureau_acs.county_2016_5yr.geo_id", "census_bureau_acs.county_2016_5yr.poverty", "census_bureau_acs.county_2016_5yr.pop_determined_poverty_status", "census_bureau_acs.county_2017_5yr.geo_id", "census_bureau_acs.county_2017_5yr.poverty", "census_bureau_acs.county_2017_5yr.pop_determined_poverty_status"]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant tables: census_bureau_acs.county_2015_5yr (for 2016 data), census_bureau_acs.county_2016_5yr (for 2017 data), census_bureau_acs.county_2017_5yr (for 2018 data), and sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity.
2. For each target year (2016-2018), join the corresponding census data from the prior 5-year ACS dataset with the natality data using county FIPS codes (geo_id = County_of_Residence_FIPS).
3. Calculate poverty rate as (poverty / pop_determined_poverty_status) * 100, ensuring pop_determined_poverty_status > 0 to avoid division by zero.
4. Calculate births_without_morbidity as SUM of Births where Maternal_Morbidity_YN = 0.
5. Compute total_births as SUM(Births) for each county/year combination.
6. Create a CTE named poverty_and_natality to unify the three yearly datasets using UNION ALL.
7. For each year in the CTE, calculate the percentage of births without morbidity as (births_without_morbidity / total_births) * 100.
8. Use the CORR function to compute Pearson correlation between poverty_rate and the calculated morbidity percentage for each data_year.
9. Group the final results by data_year to produce correlation coefficients for 2016, 2017, and 2018 separately.
# [Sql]: WITH poverty_and_natality AS (   SELECT      EXTRACT(YEAR FROM n.Year) AS data_year,     p.geo_id AS county_fips,     (p.poverty / p.pop_determined_poverty_status) * 100 AS poverty_rate,     SUM(n.Births) AS total_births,     SUM(CASE WHEN n.Maternal_Morbidity_YN = 0 THEN n.Births ELSE 0 END) AS births_without_morbidity   FROM      bigquery-public-data.census_bureau_acs.county_2015_5yr p   JOIN      bigquery-public-data.sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity n   ON p.geo_id = n.County_of_Residence_FIPS   WHERE      p.pop_determined_poverty_status > 0 AND     EXTRACT(YEAR FROM n.Year) = 2016   GROUP BY      p.geo_id, p.poverty, p.pop_determined_poverty_status, EXTRACT(YEAR FROM n.Year)   UNION ALL   SELECT      EXTRACT(YEAR FROM n.Year) AS data_year,     p.geo_id AS county_fips,     (p.poverty / p.pop_determined_poverty_status) * 100 AS poverty_rate,     SUM(n.Births) AS total_births,     SUM(CASE WHEN n.Maternal_Morbidity_YN = 0 THEN n.Births ELSE 0 END) AS births_without_morbidity   FROM      bigquery-public-data.census_bureau_acs.county_2016_5yr p   JOIN      bigquery-public-data.sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity n   ON p.geo_id = n.County_of_Residence_FIPS   WHERE      p.pop_determined_poverty_status > 0 AND     EXTRACT(YEAR FROM n.Year) = 2017   GROUP BY      p.geo_id, p.poverty, p.pop_determined_poverty_status, EXTRACT(YEAR FROM n.Year)   UNION ALL   SELECT      EXTRACT(YEAR FROM n.Year) AS data_year,     p.geo_id AS county_fips,     (p.poverty / p.pop_determined_poverty_status) * 100 AS poverty_rate,     SUM(n.Births) AS total_births,     SUM(CASE WHEN n.Maternal_Morbidity_YN = 0 THEN n.Births ELSE 0 END) AS births_without_morbidity   FROM      bigquery-public-data.census_bureau_acs.county_2017_5yr p   JOIN      bigquery-public-data.sdoh_cdc_wonder_natality.county_natality_by_maternal_morbidity n   ON p.geo_id = n.County_of_Residence_FIPS   WHERE      p.pop_determined_poverty_status > 0 AND     EXTRACT(YEAR FROM n.Year) = 2018   GROUP BY      p.geo_id, p.poverty, p.pop_determined_poverty_status, EXTRACT(YEAR FROM n.Year) ) SELECT    data_year,   CORR(poverty_rate, (births_without_morbidity / total_births) * 100) AS correlation_coefficient FROM    poverty_and_natality GROUP BY    data_year