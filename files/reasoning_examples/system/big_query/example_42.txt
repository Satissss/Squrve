# [Question]: Could you provide the highest recorded precipitation, minimum temperature, and maximum temperature from the last 15 days of each year from 2013 to 2016 at weather station USW00094846? Ensure each value represents the peak measurement for that period, with precipitation in millimeters and temperatures in degrees Celsius, using only validated data (non-null values and no quality flags)
# [Schema links]: ["ghcn_d.ghcnd_2013.date", "ghcn_d.ghcnd_2013.element", "ghcn_d.ghcnd_2013.value", "ghcn_d.ghcnd_2013.id", "ghcn_d.ghcnd_2013.qflag", "ghcn_d.ghcnd_2014.date", "ghcn_d.ghcnd_2014.element", "ghcn_d.ghcnd_2014.value", "ghcn_d.ghcnd_2014.id", "ghcn_d.ghcnd_2014.qflag", "ghcn_d.ghcnd_2015.date", "ghcn_d.ghcnd_2015.element", "ghcn_d.ghcnd_2015.value", "ghcn_d.ghcnd_2015.id", "ghcn_d.ghcnd_2015.qflag", "ghcn_d.ghcnd_2016.date", "ghcn_d.ghcnd_2016.element", "ghcn_d.ghcnd_2016.value", "ghcn_d.ghcnd_2016.id", "ghcn_d.ghcnd_2016.qflag"]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant tables for each year (ghcnd_2013, ghcnd_2014, ghcnd_2015, ghcnd_2016) containing columns: date, element, value, id, qflag.
2. For each year's table, filter rows where id = 'USW00094846', qflag IS NULL, and value IS NOT NULL to ensure validated data.
3. For each year, filter dates to the last 15 days by checking DATE_DIFF(end_of_year_date, date, DAY) < 15.
4. For each filtered dataset, compute the maximum precipitation (PRCP) divided by 10 (to convert to mm), maximum TMIN divided by 10, and maximum TMAX divided by 10 using conditional aggregation.
5. Group each year's results by extracted year to aggregate the maximum values for each element.
6. Combine the results for all four years using UNION ALL into a Common Table Expression (CTE) named data.
7. Finally, group the CTE results by year to ensure the highest values are retained and format the output columns.
# [Sql]: WITH data AS (   SELECT     EXTRACT(YEAR FROM wx.date) AS year,     MAX(IF(wx.element = 'PRCP', wx.value/10, NULL)) AS max_prcp,     MAX(IF(wx.element = 'TMIN', wx.value/10, NULL)) AS max_tmin,     MAX(IF(wx.element = 'TMAX', wx.value/10, NULL)) AS max_tmax   FROM     `bigquery-public-data.ghcn_d.ghcnd_2013` AS wx   WHERE     wx.id = 'USW00094846' AND     wx.qflag IS NULL AND     wx.value IS NOT NULL AND     DATE_DIFF(DATE('2013-12-31'), wx.date, DAY) < 15   GROUP BY     year    UNION ALL    SELECT     EXTRACT(YEAR FROM wx.date) AS year,     MAX(IF(wx.element = 'PRCP', wx.value/10, NULL)) AS max_prcp,     MAX(IF(wx.element = 'TMIN', wx.value/10, NULL)) AS max_tmin,     MAX(IF(wx.element = 'TMAX', wx.value/10, NULL)) AS max_tmax   FROM     `bigquery-public-data.ghcn_d.ghcnd_2014` AS wx   WHERE     wx.id = 'USW00094846' AND     wx.qflag IS NULL AND     wx.value IS NOT NULL AND     DATE_DIFF(DATE('2014-12-31'), wx.date, DAY) < 15   GROUP BY     year    UNION ALL    SELECT     EXTRACT(YEAR FROM wx.date) AS year,     MAX(IF(wx.element = 'PRCP', wx.value/10, NULL)) AS max_prcp,     MAX(IF(wx.element = 'TMIN', wx.value/10, NULL)) AS max_tmin,     MAX(IF(wx.element = 'TMAX', wx.value/10, NULL)) AS max_tmax   FROM     `bigquery-public-data.ghcn_d.ghcnd_2015` AS wx   WHERE     wx.id = 'USW00094846' AND     wx.qflag IS NULL AND     wx.value IS NOT NULL AND     DATE_DIFF(DATE('2015-12-31'), wx.date, DAY) < 15   GROUP BY     year    UNION ALL    SELECT     EXTRACT(YEAR FROM wx.date) AS year,     MAX(IF(wx.element = 'PRCP', wx.value/10, NULL)) AS max_prcp,     MAX(IF(wx.element = 'TMIN', wx.value/10, NULL)) AS max_tmin,     MAX(IF(wx.element = 'TMAX', wx.value/10, NULL)) AS max_tmax   FROM     `bigquery-public-data.ghcn_d.ghcnd_2016` AS wx   WHERE     wx.id = 'USW00094846' AND     wx.qflag IS NULL AND     wx.value IS NOT NULL AND     DATE_DIFF(DATE('2016-12-31'), wx.date, DAY) < 15   GROUP BY     year )  SELECT   year,   MAX(max_prcp) AS annual_max_prcp,   MAX(max_tmin) AS annual_max_tmin,   MAX(max_tmax) AS annual_max_tmax FROM data GROUP BY year ORDER BY year ASC;