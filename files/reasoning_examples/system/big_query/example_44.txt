# [Question]: Which month in 2017 had the largest absolute difference between cumulative bike usage minutes for customers and subscribers?
# [Schema links]: ["bikeshare_trips.subscriber_type", "bikeshare_trips.duration_sec", "bikeshare_trips.end_date"]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant columns: `subscriber_type`, `duration_sec`, and `end_date` from the `bikeshare_trips` table.
2. Filter trips to only those occurring in 2017 using `EXTRACT(YEAR FROM end_date) = 2017`.
3. Extract the month from `end_date` as `end_month` for grouping.
4. Calculate monthly total minutes for "Customer" and "Subscriber" types by converting `duration_sec` to minutes and summing with conditional aggregation.
5. Compute cumulative monthly totals for both subscriber types using window functions ordered by month, converting totals to thousands of minutes.
6. Calculate the absolute difference between cumulative customer and subscriber minutes for each month.
7. Rank months by the absolute difference in descending order and select the top result.
# [Sql]: WITH monthly_totals AS (   SELECT     SUM(CASE WHEN subscriber_type = 'Customer' THEN duration_sec / 60 ELSE NULL END) AS customer_minutes_sum,     SUM(CASE WHEN subscriber_type = 'Subscriber' THEN duration_sec / 60 ELSE NULL END) AS subscriber_minutes_sum,     EXTRACT(MONTH FROM end_date) AS end_month   FROM     `bigquery-public-data.san_francisco_bikeshare.bikeshare_trips`   WHERE     EXTRACT(YEAR FROM end_date) = 2017   GROUP BY     end_month ),  cumulative_totals AS (   SELECT     end_month,     SUM(customer_minutes_sum) OVER (ORDER BY end_month ROWS UNBOUNDED PRECEDING) / 1000 AS cumulative_minutes_cust,     SUM(subscriber_minutes_sum) OVER (ORDER BY end_month ROWS UNBOUNDED PRECEDING) / 1000 AS cumulative_minutes_sub   FROM     monthly_totals ),  differences AS (   SELECT     end_month,     ABS(cumulative_minutes_cust - cumulative_minutes_sub) AS abs_diff   FROM     cumulative_totals )  SELECT   end_month FROM   differences ORDER BY   abs_diff DESC LIMIT 1;