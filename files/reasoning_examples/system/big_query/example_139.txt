# [Question]: Which three cities have the largest difference between their 1990 EPA PM2.5 measurements (using units_of_measure = 'Micrograms/cubic meter (LC)' and parameter_name = 'Acceptable PM2.5 AQI & Speciation Mass') and their 2020 OpenAQ PM2.5 measurements (where pollutant = 'pm25' based on the year extracted from the timestamp), with both datasets matched by latitude and longitude rounded to two decimals, and the difference ordered from greatest to least?
# [Schema links]: ["openaq.global_air_quality.city", "epa_historical_air_quality.air_quality_annual_summary.arithmetic_mean", "openaq.global_air_quality.value", "openaq.global_air_quality.timestamp", "openaq.global_air_quality.latitude", "epa_historical_air_quality.air_quality_annual_summary.latitude", "openaq.global_air_quality.longitude", "epa_historical_air_quality.air_quality_annual_summary.longitude", "epa_historical_air_quality.air_quality_annual_summary.units_of_measure", "epa_historical_air_quality.air_quality_annual_summary.parameter_name", "epa_historical_air_quality.air_quality_annual_summary.year", "openaq.global_air_quality.pollutant"]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant tables: `openaq.global_air_quality` (OpenAQ data with city, value, timestamp, pollutant, latitude, longitude) and `epa_historical_air_quality.air_quality_annual_summary` (EPA data with arithmetic_mean, units_of_measure, parameter_name, year, latitude, longitude).
2. Filter EPA data to 1990 records with `units_of_measure = 'Micrograms/cubic meter (LC)'` and `parameter_name = 'Acceptable PM2.5 AQI & Speciation Mass'`.
3. Filter OpenAQ data to 2020 records where `pollutant = 'pm25'` and extract year from `timestamp` equals 2020.
4. Round latitude and longitude to two decimal places for both tables to match geographic coordinates.
5. Join the two tables on the rounded latitude and longitude to link EPA and OpenAQ measurements for the same location.
6. Calculate the difference between EPA's `arithmetic_mean` and OpenAQ's `value` as `epa.arithmetic_mean - aq.value`.
7. Order the results by this calculated difference in descending order to get the largest differences first.
8. Select the top three cities by limiting the result to the first three entries after ordering.
# [Sql]: SELECT   aq.city,   epa.arithmetic_mean,   aq.value,   aq.timestamp,   (epa.arithmetic_mean - aq.value) FROM   `bigquery-public-data.openaq.global_air_quality` AS aq JOIN   `bigquery-public-data.epa_historical_air_quality.air_quality_annual_summary` AS epa ON   ROUND(aq.latitude, 2) = ROUND(epa.latitude, 2)   AND ROUND(aq.longitude, 2) = ROUND(epa.longitude, 2) WHERE   epa.units_of_measure = "Micrograms/cubic meter (LC)"   AND epa.parameter_name = "Acceptable PM2.5 AQI & Speciation Mass"   AND epa.year = 1990   AND aq.pollutant = "pm25"   AND EXTRACT(YEAR FROM aq.timestamp) = 2020 ORDER BY   (epa.arithmetic_mean - aq.value) DESC LIMIT 3