# [Question]: Between 1998 and 2017, for Allegheny County in the Pittsburgh area, did the average annual wages for all industries keep pace with the inflation of all consumer items, and what were the respective percentage growth rates (to two decimal places) for wages and the CPI over that period?
# [Schema links]: [counties.geo_id, 1998*.avg_wkly_wage_10_total_all_industries, 1998*.geoid, 2017*.avg_wkly_wage_10_total_all_industries, 2017*.geoid, cpi_u.value, cpi_u.year, cpi_u.item_code, cpi_u.area_code, cpi_u.item_name, cpi_u.area_name]
# [Analysis]: Letâ€™s think step by step.
1. Retrieve Allegheny County's geo_id from the counties table using county_name = "Allegheny".
2. Calculate the average annual wage for 1998 by averaging weekly wages across all industries in Allegheny County, multiplying by 52 weeks, and rounding to two decimals.
3. Calculate the average annual wage for 2017 using the same method as 1998 with the 2017 dataset.
4. Obtain the average CPI value for 1998 by filtering for "all items" and Pittsburgh area_code, then averaging the CPI values.
5. Repeat the CPI calculation for 2017 using the same criteria as 1998.
6. Compute the percentage growth for wages using the formula ((wages_2017 - wages_1998)/wages_1998)*100, rounded to two decimals.
7. Compute the percentage growth for CPI using the formula ((cpi_2017 - cpi_1998)/cpi_1998)*100, rounded to two decimals.
8. Combine the results from all CTEs into a single row with the calculated growth rates.
# [Sql]: WITH geo AS (   SELECT DISTINCT geo_id   FROM `bigquery-public-data.geo_us_boundaries.counties`   WHERE county_name = "Allegheny"  ), avg_wage_1998 AS(   SELECT     ROUND(AVG(avg_wkly_wage_10_total_all_industries) * 52, 2) AS wages_1998   FROM     `bigquery-public-data.bls_qcew.1998*`   WHERE     geoid = (SELECT geo_id FROM geo) --Selecting Allgeheny County ),      avg_wage_2017 AS (   SELECT     ROUND(AVG(avg_wkly_wage_10_total_all_industries) * 52, 2) AS wages_2017   FROM     `bigquery-public-data.bls_qcew.2017*`   WHERE     geoid = (SELECT geo_id FROM geo) --Selecting Allgeheny County ),  avg_cpi_1998 AS (   SELECT     AVG(value) AS cpi_1998   FROM     `bigquery-public-data.bls.cpi_u` c   WHERE     year = 1998     AND item_code in (       SELECT DISTINCT item_code FROM `bigquery-public-data.bls.cpi_u` WHERE LOWER(item_name) = "all items"     )     AND area_code = (       SELECT DISTINCT area_code FROM `bigquery-public-data.bls.cpi_u` WHERE area_name LIKE '%Pittsburgh%'     ) ),  -- A104 is the code for Pittsburgh, PA -- SA0 is the code for all items      avg_cpi_2017 AS(   SELECT     AVG(value) AS cpi_2017   FROM     `bigquery-public-data.bls.cpi_u` c   WHERE     year = 2017     AND item_code in (       SELECT DISTINCT item_code FROM `bigquery-public-data.bls.cpi_u` WHERE LOWER(item_name) = "all items"     )     AND area_code = (       SELECT DISTINCT area_code FROM `bigquery-public-data.bls.cpi_u` WHERE area_name LIKE '%Pittsburgh%'     ) ) -- A104 is the code for Pittsburgh, PA -- SA0 is the code for all items  SELECT   ROUND((wages_2017 - wages_1998) / wages_1998 * 100, 2) AS wages_percent_change,   ROUND((cpi_2017 - cpi_1998) / cpi_1998 * 100, 2) AS cpi_percent_change FROM   avg_wage_2017,   avg_wage_1998,   avg_cpi_2017,   avg_cpi_1998