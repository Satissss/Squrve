# [Question]: Which assignees, excluding DENSO CORP itself, have cited patents assigned to DENSO CORP, and what are the titles of the primary CPC subclasses associated with these citations? Provide the name of each citing assignee (excluding DENSO CORP), the full title of the primary CPC subclass (based on the first CPC code), and the count of citations grouped by the citing assignee and the CPC subclass title. Ensure that only citations of patents with valid filing dates are considered, and focus on the first CPC code for each citing patent. The results should specifically exclude DENSO CORP as a citing assignee.
# [Schema links]: ['PUBLICATIONS.citation', 'PUBLICATIONS.assignee_harmonized', 'PUBLICATIONS.cpc', 'PUBLICATIONS.publication_number', 'PUBLICATIONS.assignee_harmonized', 'PUBLICATIONS.publication_number', 'CPC_DEFINITION.titleFull', 'CPC_DEFINITION.symbol']
# [Analysis]: # Output: Letâ€™s think step by step.
1. Identify the relevant tables: `PUBLICATIONS` (for patent data including citations, assignees, and CPC codes) and `CPC_DEFINITION` (for CPC subclass titles).
2. Flatten the `citation` array in `PUBLICATIONS` to extract each cited publication number for every patent.
3. Flatten the `assignee_harmonized` array in `PUBLICATIONS` to get the citing assignee names for each patent.
4. Flatten the `cpc` array in `PUBLICATIONS` and filter for the first CPC code (where `"first" = TRUE`) to get the primary CPC subclass for each citing patent.
5. Extract the first 4 characters of the CPC code to get the subclass symbol.
6. Create a subquery to handle the citing side: select the citing publication number, cited publication number (from the flattened citation), citing assignee name, and citing CPC subclass.
7. Create another subquery to handle the cited side: flatten the `assignee_harmonized` array for the cited patents to get the assignee names, and select the publication number and assignee name.
8. Join the citing subquery with the cited subquery on the cited publication number to link citations to patents assigned to DENSO CORP.
9. Filter the cited subquery to only include patents where the cited assignee is 'DENSO CORP'.
10. Exclude any citations where the citing assignee is 'DENSO CORP'.
11. Join the result with `CPC_DEFINITION` on the CPC subclass symbol to get the full title of the subclass.
12. Group the results by citing assignee and CPC subclass title to count the number of citations for each combination.
13. Use `REPLACE` to remove any double quotes from the citing assignee name for clean output.
# [Sql]: SELECT     REPLACE(citing_assignee, '"', '') AS citing_assignee,     cpcdef."titleFull" AS cpc_title,     COUNT(*) AS number FROM (     SELECT         pubs."publication_number" AS citing_publication_number,         cite.value:"publication_number" AS cited_publication_number,         citing_assignee_s.value:"name" AS citing_assignee,         SUBSTR(cpcs.value:"code", 1, 4) AS citing_cpc_subclass     FROM          PATENTS.PATENTS.PUBLICATIONS AS pubs     , LATERAL FLATTEN(input => pubs."citation") AS cite     , LATERAL FLATTEN(input => pubs."assignee_harmonized") AS citing_assignee_s     , LATERAL FLATTEN(input => pubs."cpc") AS cpcs     WHERE         cpcs.value:"first" = TRUE ) AS pubs JOIN (     SELECT         "publication_number" AS cited_publication_number,         cited_assignee_s.value:"name" AS cited_assignee     FROM         PATENTS.PATENTS.PUBLICATIONS     , LATERAL FLATTEN(input => "assignee_harmonized") AS cited_assignee_s ) AS refs     ON pubs.cited_publication_number = refs.cited_publication_number JOIN     PATENTS.PATENTS.CPC_DEFINITION AS cpcdef     ON cpcdef."symbol" = pubs.citing_cpc_subclass WHERE     refs.cited_assignee = 'DENSO CORP'     AND pubs.citing_assignee != 'DENSO CORP' GROUP BY     citing_assignee, cpcdef."titleFull"