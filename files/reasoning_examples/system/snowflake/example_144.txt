# [Question]: In the Iowa Liquor Sales dataset, starting from January 1, 2022 through the last fully completed month, which two liquor categories, each contributing an average of at least 1% to the monthly sales volume over at least 24 months of available data, have the lowest Pearson correlation coefficient when comparing their monthly percentages of total liquor sales across those months, and what are their names?
# [Schema links]: [sales.date, sales.category, sales.volume_sold_liters, sales.category_name]
# [Analysis]: Letâ€™s think step by step.
1. Filter sales data to include records from 2022-01-01 to the last completed month before current date.
2. Aggregate monthly sales volume by category and month to create monthly_sales CTE.
3. Calculate total monthly sales across all categories to create total_monthly_sales CTE.
4. Compute each category's monthly percentage of total sales using the two CTEs to create category_percentage CTE.
5. Identify qualified categories with >=24 months of data and average percentage >=1% using HAVING clause.
6. Join category_percentage with itself on month to calculate pairwise correlations between qualified categories.
7. Use CORR function to compute Pearson correlation coefficients for category pairs ensuring category1 < category2 to avoid duplicates.
8. Retrieve category names by joining with distinct category_name mappings from source table.
9. Order correlation results by pearson_correlation ascending and select top 1 pair with lowest correlation.
# [Sql]: WITH monthly_sales AS (     SELECT         DATE_TRUNC('MONTH', "date") AS month,         "category",         SUM("volume_sold_liters") AS monthly_volume     FROM         IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES     WHERE         "date" >= '2022-01-01'         AND "date" < DATE_TRUNC('MONTH', CURRENT_DATE())     GROUP BY         1, 2 ), total_monthly_sales AS (     SELECT         month,         SUM(monthly_volume) AS total_volume     FROM         monthly_sales     GROUP BY         1 ), category_percentage AS (     SELECT         ms.month,         ms."category",         (ms.monthly_volume / tms.total_volume) * 100 AS percentage     FROM         monthly_sales ms     JOIN         total_monthly_sales tms     ON         ms.month = tms.month ), qualified_categories AS (     SELECT         "category"     FROM         category_percentage     GROUP BY         1     HAVING         COUNT(month) >= 24         AND AVG(percentage) >= 1 ), category_names AS (     SELECT         DISTINCT "category",         "category_name"     FROM         IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES ), correlation AS (     SELECT         c1."category" AS category1,         c2."category" AS category2,         CORR(c1.percentage, c2.percentage) AS pearson_correlation     FROM         category_percentage c1     JOIN         category_percentage c2     ON         c1.month = c2.month         AND c1."category" < c2."category"     WHERE         c1."category" IN (SELECT "category" FROM qualified_categories)         AND c2."category" IN (SELECT "category" FROM qualified_categories)     GROUP BY         1, 2 ), final_result AS (     SELECT         corr.category1,         corr.category2,         cn1."category_name" AS category1_name,         cn2."category_name" AS category2_name,         corr.pearson_correlation     FROM         correlation corr     JOIN         category_names cn1     ON         corr.category1 = cn1."category"     JOIN         category_names cn2     ON         corr.category2 = cn2."category"     ORDER BY         corr.pearson_correlation ASC     LIMIT 1 ) SELECT * FROM final_result;