# [Question]: For patent class A01B3, I want to analyze the information of the top 3 assignees based on the total number of applications. Please provide the following five pieces of information: the name of this assignee,  total number of applications, the year with the most applications, the number of applications in that year, and the country code with the most applications during that year.
# [Schema links]: ["PUBLICATIONS.assignee_harmonized", "PUBLICATIONS.filing_date", "PUBLICATIONS.country_code", "PUBLICATIONS.application_number"]
# [Analysis]: Letâ€™s think step by step.
1. Filter publications to include only those with CPC codes starting with 'A01B3' using LATERAL FLATTEN and LIKE 'A01B3%'.
2. Extract assignee names from the assignee_harmonized array using LATERAL FLATTEN to handle array structure.
3. Calculate annual application counts per country for each assignee by grouping on assignee_name, filing_year, and country_code.
4. Identify the country with the highest applications for each assignee's filing year using ROW_NUMBER() partitioned by assignee_name and filing_year.
5. Aggregate total applications per assignee by summing their yearly counts and determine their peak application year.
6. Rank assignees by total applications using ROW_NUMBER() and select top 3.
7. Format output to include assignee name, total applications, peak year, applications in that year, and corresponding country code.
8. Clean assignee name by removing quotes and ensure final ordering by total_count descending with LIMIT 3.
# [Sql]: WITH PatentApplications AS (    SELECT          "assignee_harmonized" AS assignee_harmonized,         "filing_date" AS filing_date,         "country_code" AS country_code,         "application_number" AS application_number     FROM          PATENTS.PATENTS.PUBLICATIONS AS pubs,         LATERAL FLATTEN(input => pubs."cpc") AS c     WHERE c.value:"code" LIKE 'A01B3%'  ),  AssigneeApplications AS (     SELECT          COUNT(*) AS year_country_cnt,         a.value:"name" AS assignee_name,         CAST(FLOOR(filing_date / 10000) AS INT) AS filing_year,         apps.country_code as country_code     FROM          PatentApplications as apps,         LATERAL FLATTEN(input => assignee_harmonized) AS a     GROUP BY          assignee_name, filing_year, country_code ),  RankedApplications AS (     SELECT         assignee_name,         filing_year,         country_code,         year_country_cnt,         SUM(year_country_cnt) OVER (PARTITION BY assignee_name, filing_year) AS total_cnt,         ROW_NUMBER() OVER (PARTITION BY assignee_name, filing_year ORDER BY year_country_cnt DESC) AS rn     FROM         AssigneeApplications ),  AggregatedData AS (     SELECT         total_cnt AS year_cnt,         assignee_name,         filing_year,         country_code     FROM         RankedApplications     WHERE         rn = 1 )   SELECT      total_count,     REPLACE(assignee_name, '"', '') AS assignee_name,     year_cnt,     filing_year,     country_code FROM (     SELECT          year_cnt,         assignee_name,         filing_year,         country_code,         SUM(year_cnt) OVER (PARTITION BY assignee_name) AS total_count,         ROW_NUMBER() OVER (PARTITION BY assignee_name ORDER BY year_cnt DESC) AS rn     FROM         AggregatedData     ORDER BY assignee_name ) sub WHERE rn = 1 ORDER BY total_count DESC LIMIT 3