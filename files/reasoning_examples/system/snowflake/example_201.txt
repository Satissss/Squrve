# [Question]: As of December 31, 2022, list the top 10 active banks with assets exceeding $10 billion, ranked by the highest percentage of uninsured assets, where the percentage is calculated as one minus the value of the '% Insured (Estimated)' variable from quarterly estimates. Provide the names of these banks and their respective percentages of uninsured assets.
# [Schema links]: ['financial_institution_timeseries.id_rssd', 'financial_institution_timeseries.variable', 'financial_institution_timeseries.date', 'financial_institution_timeseries.value', 'financial_institution_attributes.variable', 'financial_institution_attributes.variable_name', 'financial_institution_attributes.frequency', 'financial_institution_entities.id_rssd', 'financial_institution_entities.is_active', 'financial_institution_entities.name']
# [Analysis]: # Output: Letâ€™s think step by step.
1. Identify the need to filter for banks with assets exceeding $10 billion as of December 31, 2022. This requires querying the `financial_institution_timeseries` table for the 'ASSET' variable on that date where value > 1E10.
2. Create a CTE named `big_banks` to store the `id_rssd` values of these qualifying banks.
3. Join the `financial_institution_timeseries` table with `financial_institution_attributes` on the `variable` column to access the variable names and filter for '% Insured (Estimated)'.
4. Join the result with `financial_institution_entities` on `id_rssd` to get the bank names and filter for active banks (`is_active = True`).
5. Filter the timeseries data for the specific date '2022-12-31' and ensure the attribute frequency is 'Quarterly'.
6. Calculate the percentage of uninsured assets as (1 - value) since the value represents the '% Insured (Estimated)'.
7. Order the results by the calculated uninsured percentage in descending order to rank from highest to lowest.
8. Limit the output to the top 10 banks.
# [Sql]: WITH big_banks AS (     SELECT id_rssd     FROM FINANCE__ECONOMICS.CYBERSYN.financial_institution_timeseries     WHERE variable = 'ASSET'       AND date = '2022-12-31'       AND value > 1E10 ) SELECT name FROM FINANCE__ECONOMICS.CYBERSYN.financial_institution_timeseries AS ts INNER JOIN FINANCE__ECONOMICS.CYBERSYN.financial_institution_attributes AS att ON (ts.variable = att.variable) INNER JOIN FINANCE__ECONOMICS.CYBERSYN.financial_institution_entities AS ent ON (ts.id_rssd = ent.id_rssd) INNER JOIN big_banks ON (big_banks.id_rssd = ts.id_rssd) WHERE ts.date = '2022-12-31'   AND att.variable_name = '% Insured (Estimated)'   AND att.frequency = 'Quarterly'   AND ent.is_active = True ORDER BY (1 - value) DESC LIMIT 10;