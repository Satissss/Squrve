# [Question]: Which assignees, excluding DENSO CORP itself, have cited patents assigned to DENSO CORP, and what are the titles of the primary CPC subclasses associated with these citations? Provide the name of each citing assignee (excluding DENSO CORP), the full title of the primary CPC subclass (based on the first CPC code), and the count of citations grouped by the citing assignee and the CPC subclass title. Ensure that only citations of patents with valid filing dates are considered, and focus on the first CPC code for each citing patent. The results should specifically exclude DENSO CORP as a citing assignee.
# [Schema links]: ["PATENTS.PUBLICATIONS.publication_number", "PATENTS.PUBLICATIONS.assignee_harmonized", "PATENTS.PUBLICATIONS.citation", "PATENTS.PUBLICATIONS.cpc", "PATENTS.CPC_DEFINITION.symbol", "PATENTS.CPC_DEFINITION.titleFull"]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant tables: PATENTS.PUBLICATIONS (publication_number, assignee_harmonized, citation, cpc) and PATENTS.CPC_DEFINITION (symbol, titleFull).
2. Extract citing assignees from assignee_harmonized using LATERAL FLATTEN to handle array data.
3. Filter citations where the cited patent's assignee includes DENSO CORP via subquery checking assignee_harmonized.
4. Exclude rows where citing_assignee equals 'DENSO CORP' in the WHERE clause.
5. Use LATERAL FLATTEN on cpc array and filter for first CPC code (cpcs.value:"first" = TRUE).
6. Join with CPC_DEFINITION using SUBSTR(cpc_code,1,4) to match symbol for titleFull retrieval.
7. Aggregate citation counts grouped by citing_assignee and cpc_title while excluding DENSO CORP from results.
# [Sql]: WITH cited_patents AS (     SELECT         pubs."publication_number" AS publication_number,         assignee_s.value:"name"::STRING AS citing_assignee,         cpcs.value:"code"::STRING AS cpc_code     FROM         PATENTS.PATENTS.PUBLICATIONS AS pubs     JOIN LATERAL FLATTEN(input => pubs."assignee_harmonized") AS assignee_s     JOIN LATERAL FLATTEN(input => pubs."citation") AS cite     JOIN LATERAL FLATTEN(input => pubs."cpc") AS cpcs     WHERE         cpcs.value:"first" = TRUE         AND assignee_s.value:"name"::STRING != 'DENSO CORP'         AND EXISTS (             SELECT 1             FROM PATENTS.PATENTS.PUBLICATIONS AS cited_pubs             JOIN LATERAL FLATTEN(input => cited_pubs."assignee_harmonized") AS cited_assignee_s             WHERE cited_pubs."publication_number" = cite.value:"publication_number"::STRING             AND cited_assignee_s.value:"name"::STRING = 'DENSO CORP'         ) ) SELECT     REPLACE(citing_assignee, '"', '') AS citing_assignee,     cpcdef."titleFull" AS cpc_title,     COUNT(*) AS citation_count FROM     cited_patents AS cp JOIN PATENTS.PATENTS.CPC_DEFINITION AS cpcdef     ON cpcdef."symbol" = SUBSTR(cp.cpc_code, 1, 4) GROUP BY     citing_assignee, cpc_title;