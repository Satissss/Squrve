# [Question]: In the Iowa Liquor Sales dataset, starting from January 1, 2022 through the last fully completed month, which two liquor categories, each contributing an average of at least 1% to the monthly sales volume over at least 24 months of available data, have the lowest Pearson correlation coefficient when comparing their monthly percentages of total liquor sales across those months, and what are their names?
# [Schema links]: ['SALES.date', 'SALES.volume_sold_gallons', 'SALES.category', 'SALES.category_name']
# [Analysis]: # Output: Letâ€™s think step by step.
1. Filter the sales data to include only records from January 1, 2022, up to but not including the current month to ensure only fully completed months are considered.
2. Calculate the total monthly sales volume (in gallons) for each month by grouping sales data by year-month and summing the volume_sold_gallons.
3. For each liquor category in each month, calculate the monthly sales volume and determine its percentage contribution to the total monthly sales volume.
4. Join the category-level monthly data with the monthly totals to compute the percentage for each category.
5. For every pair of distinct liquor categories, join their monthly percentage data on the month to align their sales percentages across time.
6. For each category pair, count the number of months with available data and ensure it is at least 24.
7. Calculate the average monthly percentage contribution for each category in the pair and filter to include only those with an average of at least 1%.
8. Compute the Pearson correlation coefficient between the monthly percentage contributions of the two categories across all available months.
9. Order all qualifying category pairs by their correlation coefficient in ascending order to find the pair with the lowest correlation.
10. Select the names of the two categories from the top result (lowest correlation) and limit the output to this single pair.
# [Sql]: WITH MonthlyTotals AS (   SELECT     TO_CHAR("date", 'YYYY-MM') AS "month",     SUM("volume_sold_gallons") AS "total_monthly_volume"   FROM     IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES."SALES"   WHERE     "date" >= '2022-01-01'      AND TO_CHAR("date", 'YYYY-MM') < TO_CHAR(CURRENT_DATE(), 'YYYY-MM')   GROUP BY     TO_CHAR("date", 'YYYY-MM') ),  MonthCategory AS (   SELECT     TO_CHAR("date", 'YYYY-MM') AS "month",     "category",     "category_name",     SUM("volume_sold_gallons") AS "category_monthly_volume",     CASE        WHEN "total_monthly_volume" != 0 THEN (SUM("volume_sold_gallons") / "total_monthly_volume") * 100       ELSE NULL     END AS "category_pct_of_month_volume"   FROM     IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES."SALES" AS Sales   LEFT JOIN     MonthlyTotals ON TO_CHAR(Sales."date", 'YYYY-MM') = MonthlyTotals."month"   WHERE     Sales."date" >= '2022-01-01'      AND TO_CHAR(Sales."date", 'YYYY-MM') < TO_CHAR(CURRENT_DATE(), 'YYYY-MM')   GROUP BY     TO_CHAR(Sales."date", 'YYYY-MM'), "category", "category_name", "total_monthly_volume" ),  middle_info AS  (   SELECT     Category1."category" AS "category1",     Category1."category_name" AS "category_name1",     Category2."category" AS "category2",     Category2."category_name" AS "category_name2",     COUNT(DISTINCT Category1."month") AS "num_months",     CORR(Category1."category_pct_of_month_volume", Category2."category_pct_of_month_volume") AS "category_corr_across_months",     AVG(Category1."category_pct_of_month_volume") AS "category1_avg_pct_of_month_volume",     AVG(Category2."category_pct_of_month_volume") AS "category2_avg_pct_of_month_volume"   FROM     MonthCategory Category1   INNER JOIN     MonthCategory Category2      ON Category1."month" = Category2."month"   GROUP BY     Category1."category", Category1."category_name", Category2."category", Category2."category_name"   HAVING     "num_months" >= 24     AND "category1_avg_pct_of_month_volume" >= 1     AND "category2_avg_pct_of_month_volume" >= 1 )  SELECT    "category_name1",    "category_name2" FROM    middle_info ORDER BY    "category_corr_across_months" LIMIT 1;