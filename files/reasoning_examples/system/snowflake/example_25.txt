# [Question]: What are the top 5 zip codes of the areas in the United States that have experienced the most hail storm events in the past 10 years? Don't use data from hail reports table.
# [Schema links]: [snoaa_historic_severe_storms.storms.event_id, noaa_historic_severe_storms.storms.event_type, noaa_historic_severe_storms.storms.event_point, geo_us_boundaries.zip_codes.city, geo_us_boundaries.zip_codes.state_name, geo_us_boundaries.zip_codes.zip_code, geo_us_boundaries.zip_codes.zip_code_geom]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant tables: `noaa_historic_severe_storms.storms` (contains storm events with event_type and event_point) and `geo_us_boundaries.zip_codes` (contains zip_code, city, state_name, and geometry).
2. Filter storms to only include 'hail' events using `WHERE LOWER(event_type) = 'hail'`.
3. Combine yearly storm tables (2014-2024) into a single storms dataset using `UNION ALL` to cover the past 10 years.
4. Perform a spatial join between storms and zip_codes using `ST_WITHIN` to match storm locations (event_point) with zip_code geometries (zip_code_geom).
5. Group the joined results by zip_code, city, and state_name to aggregate storm counts per zip code.
6. Count the number of hail events per zip code using `COUNT(event_id) AS count_storms`.
7. Sort the results in descending order by count_storms to rank zip codes by storm frequency.
8. Limit the output to the top 5 records to get the highest-ranked zip codes.
9. Format the output to display concatenated city and state_name, zip_code, and storm count.
# [Sql]: SELECT   CONCAT("city", ', ', "state_name") AS "city",   "zip_code",   COUNT("event_id") AS "count_storms" FROM (     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2014     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2015     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2016     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2017     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2018     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2019     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2020     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2021     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2022     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2023     UNION ALL     SELECT *     FROM NOAA_DATA_PLUS.NOAA_HISTORIC_SEVERE_STORMS.STORMS_2024 ) AS storms JOIN NOAA_DATA_PLUS.GEO_US_BOUNDARIES.ZIP_CODES   ON ST_WITHIN(ST_GEOGFROMWKB(storms."event_point"), ST_GEOGFROMWKB("zip_code_geom")) WHERE    LOWER(storms."event_type") = 'hail' GROUP BY   "zip_code",    "city",    "state_name" ORDER BY   "count_storms" DESC LIMIT 5;