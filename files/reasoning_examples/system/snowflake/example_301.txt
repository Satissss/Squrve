# [Question]: Please provide a list of the top three revenue-generating films for each actor, along with the average revenue per actor in those films, calculated by dividing the total film revenue equally among the actors for each film.
# [Schema links]: ['FILM.film_id', 'FILM.title', 'FILM_ACTOR.actor_id', 'PAYMENT.amount', 'RENTAL.rental_id', 'INVENTORY.inventory_id', 'INVENTORY.film_id']
# [Analysis]: # Output: Letâ€™s think step by step.
1. Identify the need to calculate the number of actors per film by joining the FILM and FILM_ACTOR tables and counting actors for each film.
2. Create a CTE named ACTOR_COUNT to store film_id, title, and the count of actors (num_actors) for each film.
3. Identify the need to calculate total revenue per film by joining PAYMENT, RENTAL, and INVENTORY tables and summing the payment amounts grouped by film_id.
4. Create a CTE named FILM_REVENUE to store film_id and the total gross_revenue for each film.
5. Calculate the revenue per actor for each film by dividing the gross_revenue from FILM_REVENUE by the num_actors from ACTOR_COUNT.
6. Create a CTE named FILM_REV_PER_ACTOR to store the film title and the calculated rev_per_actor.
7. Select all columns from FILM_REV_PER_ACTOR and order by rev_per_actor in descending order.
8. Limit the results to the top 3 rows using FETCH FIRST 3 ROWS ONLY.
# [Sql]: WITH      ACTOR_COUNT AS (         SELECT              f."film_id",             f."title",             COUNT(fa."actor_id") AS num_actors         FROM              SQLITE_SAKILA.SQLITE_SAKILA.FILM f         JOIN              SQLITE_SAKILA.SQLITE_SAKILA.FILM_ACTOR fa ON fa."film_id" = f."film_id"         GROUP BY              f."film_id", f."title"         ORDER BY              f."film_id"     ),     FILM_REVENUE AS (         SELECT              i."film_id",             SUM(p."amount") AS gross_revenue         FROM              SQLITE_SAKILA.SQLITE_SAKILA.PAYMENT p         JOIN              SQLITE_SAKILA.SQLITE_SAKILA.RENTAL r ON r."rental_id" = p."rental_id"         JOIN              SQLITE_SAKILA.SQLITE_SAKILA.INVENTORY i ON i."inventory_id" = r."inventory_id"         GROUP BY              i."film_id"         ORDER BY              i."film_id"     ),     FILM_REV_PER_ACTOR AS (         SELECT              ac."title",             fr.gross_revenue / ac.num_actors * 1.0 AS rev_per_actor         FROM              ACTOR_COUNT ac         JOIN              FILM_REVENUE fr ON fr."film_id" = ac."film_id"     ) SELECT      * FROM      FILM_REV_PER_ACTOR ORDER BY      rev_per_actor DESC FETCH FIRST 3 ROWS ONLY;