# [Question]: For each year, which driver and which constructor scored the most points? I want the full name of each driver.
# [Schema links]: [races.year, drivers.forename, drivers.surname, drivers.driver_id, results.points, constructors.constructor_id, constructors.name]
# [Analysis]: Letâ€™s think step by step.
1. Identify the relevant tables and columns: `races` (year), `drivers` (forename, surname, driver_id), `results` (points, driver_id, constructor_id), and `constructors` (constructor_id, name).
2. Calculate total points for each driver per year by joining `results` with `drivers` and `races`, grouping by year, driver_id, and driver's full name (forename + surname).
3. Calculate total points for each constructor per year by joining `results` with `constructors` and `races`, grouping by year and constructor_id.
4. Rank drivers within each year by their total points using `RANK()` to identify the top driver (rank = 1).
5. Rank constructors within each year by their total points using `RANK()` to identify the top constructor (rank = 1).
6. Join the top-ranked driver and constructor results on the year to combine their information.
7. Retrieve the constructor's name by joining the `constructors` table with the top constructor's constructor_id.
8. Select the year, driver's full name, and constructor's name where both ranks are 1.
# [Sql]: WITH yearly_driver_points AS (     SELECT         r.year,         d.forename || ' ' || d.surname AS driver_full_name,         d.driver_id,         SUM(res.points) AS total_points     FROM         results res     JOIN         drivers d ON res.driver_id = d.driver_id     JOIN         races r ON res.race_id = r.race_id     GROUP BY         r.year, d.forename, d.surname, d.driver_id ), yearly_constructor_points AS (     SELECT         r.year,         c.constructor_id,         SUM(res.points) AS total_points     FROM         results res     JOIN         constructors c ON res.constructor_id = c.constructor_id     JOIN         races r ON res.race_id = r.race_id     GROUP BY         r.year, c.constructor_id ), top_drivers AS (     SELECT         ydp.year,         ydp.driver_full_name,         ydp.driver_id,         ydp.total_points,         RANK() OVER (PARTITION BY ydp.year ORDER BY ydp.total_points DESC) AS rank     FROM         yearly_driver_points ydp ), top_constructors AS (     SELECT         ycp.year,         ycp.constructor_id,         ycp.total_points,         RANK() OVER (PARTITION BY ycp.year ORDER BY ycp.total_points DESC) AS rank     FROM         yearly_constructor_points ycp ) SELECT     td.year,     td.driver_full_name,     c.name AS constructor_name FROM     top_drivers td JOIN     top_constructors tc ON td.year = tc.year JOIN     constructors c ON tc.constructor_id = c.constructor_id WHERE     td.rank = 1 AND tc.rank = 1;