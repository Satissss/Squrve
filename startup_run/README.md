# Squrve æ¡†æ¶å¿«é€Ÿå¯åŠ¨

æœ¬æ–‡ä»¶ä»‹ç»å¦‚ä½•åŸºäº Squrve æ¡†æ¶ï¼Œä»…é€šè¿‡æ›´æ¢é…ç½®å‚æ•°ï¼Œå³å¯å®ç°ä¸åŒæ•°æ®é›†ä¸Šå¯¹å¤šç§åŸºçº¿æ–¹æ³•å®ç° Text-to-SQL ä»»åŠ¡çš„è¡¨ç°å¹¶å‘æµ‹è¯•ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²æŒ‰ç…§æ ¹ç›®å½•ä¸‹çš„ [`README`](https://github.com/Satissss/Squrve) æ–‡ä»¶å®Œæˆæ‰€æœ‰ç¯å¢ƒé…ç½®æ­¥éª¤ã€‚

### 2. è¿è¡Œç¤ºä¾‹

ä»»ä½• Text-to-SQL ä»»åŠ¡å‡å¯ä»¥é€šè¿‡ run.py ä¸‹çš„ç®€å•æ•°è¡Œä»£ç å®Œæˆï¼Œä»…éœ€è¦æä¾›ä»»åŠ¡å¯åŠ¨æ‰€éœ€çš„æ­£ç¡®é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ã€‚

```python 
from core.base import Router
from core.engine import Engine

if __name__ == "__main__":
    router = Router(config_path="startup_config.json")

    engine = Engine(router)

    # æ‰§è¡Œä»»åŠ¡
    print("æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡ä¸­...")
    engine.execute()

    # è¯„ä¼°ç»“æœ
    print("è¯„ä¼°ç»“æœä¸­...")
    engine.evaluate()

    print("è‡ªå®šä¹‰ä»»åŠ¡å®Œæˆ!")

```

startup_config.json ä½œä¸ºå¿«é€Ÿå¯åŠ¨ç¤ºä¾‹ï¼Œæä¾›äº†ä¸€ä¸ªåœ¨ Spider-dev åŸºå‡†æ•°æ®é›†ä¸Šè¿è¡Œ DIN-SQL æ–¹æ³•çš„ç®€å•ç¤ºä¾‹ã€‚é€šè¿‡è¿è¡Œ run.py å³å¯å¿«é€Ÿå¯åŠ¨ Squrve æ¡†æ¶ã€‚

```bash
python startup_run/run.py
```


## ğŸ“ è¿è¡ŒæˆåŠŸ

### æ§åˆ¶å°è¾“å‡º

ä»£ç å¯åŠ¨åï¼Œæ§åˆ¶å°é¦–å…ˆè¾“å‡ºåŸºæœ¬ä¿¡æ¯ã€‚
![img.png](../assets/run_start.png)

å•ä¸ªæ ·æœ¬æ‰§è¡Œè¿‡ç¨‹ä¿¡æ¯æ‰“å°ï¼š
![img.png](../assets/run_single.png)

æ ·ä¾‹æµ‹è¯•è¿è¡Œå®Œæˆåï¼Œè¾“å‡ºè¯„ä¼°ç»“æœå’Œä»»åŠ¡ç›¸å…³ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
![img.png](../assets/img.png)

è¿è¡Œå®Œæˆåï¼Œç»“æœæ–‡ä»¶å°†ä¿å­˜åœ¨ä»¥ä¸‹ç›®å½•ï¼š

### æ–‡ä»¶å¤¹è¾“å‡º

æ ¹æ®é…ç½®ï¼Œç”Ÿæˆçš„æ¯ä¸ªæ ·æœ¬çš„ SQL è¯­å¥å°†ä¿å­˜åœ¨ `files/pred_sql/` ç›®å½•ä¸‹ï¼š 
![img.png](../assets/pred_sql.png)!

å¤„ç†åçš„å®Œæ•´çš„æ•°æ®é›†å°†ä¿å­˜åœ¨ `files/datasets/` ç›®å½•ä¸‹ï¼š

## ğŸ¯ è§£æé…ç½®

### 1. ç®€å•ç”Ÿæˆä»»åŠ¡ (`generate`)

ç›´æ¥ç”Ÿæˆ SQL æŸ¥è¯¢ï¼Œè·³è¿‡æ¨¡å¼é™ç»´å’Œæ¨¡å¼é“¾æ¥æ­¥éª¤ã€‚

### 2. å®Œæ•´æµæ°´çº¿ä»»åŠ¡

æ‰§è¡Œå®Œæ•´çš„ Text-to-SQL æµç¨‹ï¼š

1. **æ¨¡å¼é™ç»´** (`reduce`): æ ¹æ®é—®é¢˜ç­›é€‰ç›¸å…³æ•°æ®åº“æ¨¡å¼
2. **æ¨¡å¼é“¾æ¥** (`parse`): è§£æé—®é¢˜ä¸­æåˆ°çš„è¡¨å’Œå­—æ®µ
3. **æŸ¥è¯¢ç”Ÿæˆ** (`generate`): ç”Ÿæˆæœ€ç»ˆçš„ SQL æŸ¥è¯¢

### 3. å¤æ‚ä»»åŠ¡

æ”¯æŒä»»åŠ¡åµŒå¥—å’Œå¹¶è¡Œæ‰§è¡Œï¼š

- **ä¸²è¡Œæ‰§è¡Œ**: ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ
- **å¹¶è¡Œæ‰§è¡Œ**: å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ
- **åµŒå¥—ä»»åŠ¡**: ä»»åŠ¡å†…éƒ¨åŒ…å«å­ä»»åŠ¡

## ğŸ“Š é…ç½®æ–‡ä»¶è¯¦è§£

### Startup æµ‹è¯•é…ç½® (`config/spider_dev_config.json`)

è¯¥é…ç½®æ–‡ä»¶æä¾›äº† Spider dev æ•°æ®é›†æµ‹è¯•æ ·ä¾‹ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦éƒ¨åˆ†ï¼š

#### LLM é…ç½®

```json
{
  "llm": {
    "use": "qwen",
    "model_name": "qwen-turbo",
    "context_window": 120000,
    "max_token": 8000,
    "temperature": 0.75
  }
}
```

* use: ä½¿ç”¨ Base LLM ç±»å‹

#### æ•°æ®é›†é…ç½®

```json
{
  "dataset": {
    "data_source": "spider:dev",
    "db_path": "benchmarks/spider/database"
  }
}
```

* data_source: å®éªŒæ•°æ®é›†ï¼Œ"spider:dev" benchmarkå·²æ³¨å†Œï¼Œæ”¯æŒè‡ªåŠ¨è§£æã€‚
* db_path: è¿æ¥æ•°æ®åº“è·¯å¾„ï¼Œç³»ç»Ÿé…ç½®ä»…æä¾›æ”¯æŒçš„æ•°æ®åº“é…ç½®

#### ä»»åŠ¡é…ç½®

```json
{
  "task": {
    "task_meta": [
      {
        "task_id": "spider_dev_generate",
        "task_type": "generate",
        "data_source": "spider:dev",
        "schema_source": "spider:dev"
      }
    ]
  }
}
```

